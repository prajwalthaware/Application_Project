# RabbitMQ Configuration Template
# Generated by Ansible for {{ cluster_name | default('rmq_cluster') }}
# Node: {{ ansible_hostname }}

# =============================================================================
# CLUSTER CONFIGURATION
# =============================================================================
cluster_formation.peer_discovery_backend = classic_config
cluster_formation.classic_config.nodes.1 = rabbit@{{ hostvars[groups['rabbitmq_nodes'][0]]['ansible_hostname'] }}
cluster_formation.classic_config.nodes.2 = rabbit@{{ hostvars[groups['rabbitmq_nodes'][1]]['ansible_hostname'] }}
cluster_formation.classic_config.nodes.3 = rabbit@{{ hostvars[groups['rabbitmq_nodes'][2]]['ansible_hostname'] }}

# Cluster name for identification
cluster_name = {{ cluster_name | default('rmq_cluster') }}

# =============================================================================
# NETWORKING
# =============================================================================
# AMQP listener
listeners.tcp.default = 5672

# Management UI listener
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0

# Erlang distribution port range
distribution.listener.port_range.min = 25672
distribution.listener.port_range.max = 25672

# =============================================================================
# RESOURCE LIMITS
# =============================================================================
# Memory watermark - block publishers when memory usage exceeds this
vm_memory_high_watermark.relative = {{ memory_watermark | default('0.4') }}

# Disk free space limit - block publishers when disk space falls below this
disk_free_limit.absolute = {{ disk_watermark | default('1GB') }}

# =============================================================================
# QUEUE CONFIGURATION (Quorum Queues Default)
# =============================================================================
# Default queue type for new queues
default_queue_type = quorum

# Quorum queue settings
quorum_queue.default_election_ticks = 5
quorum_queue.default_replication_factor = 3

# =============================================================================
# CONNECTION & CHANNEL LIMITS
# =============================================================================
# Maximum number of channels per connection
channel_max = {{ max_channels | default('2047') }}

# Heartbeat timeout (seconds)
heartbeat = {{ heartbeat_timeout | default('60') }}

# Connection timeout (milliseconds)
handshake_timeout = {{ handshake_timeout | default('10000') }}

# =============================================================================
# LOGGING
# =============================================================================
log.dir = /var/log/rabbitmq
log.file = rabbit.log
log.file.level = {{ log_level | default('info') }}

# Log rotation
log.file.rotation.date = $D0
log.file.rotation.count = 7

# =============================================================================
# STATISTICS & METRICS
# =============================================================================
# Collect statistics interval (milliseconds)
collect_statistics_interval = {{ stats_interval | default('5000') }}

# =============================================================================
# CUSTOM PARAMETERS
# =============================================================================
{% if custom_params is defined %}
{% for key, value in custom_params.items() %}
{{ key }} = {{ value }}
{% endfor %}
{% endif %}
